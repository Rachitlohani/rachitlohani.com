---
import BaseLayout from "../layouts/BaseLayout.astro";
import Nav from "../components/Nav.astro";
import Footer from "../components/Footer.astro";
import { mediaItems } from "../data/media";

const title = "Media â€” Rachit Lohani";
const description = "Interviews, talks, and media appearances featuring Rachit Lohani.";

const itemListSchema = {
  "@context": "https://schema.org",
  "@type": "ItemList",
  itemListElement: mediaItems.map((item, index) => {
    const url = new URL(item.url);
    if (item.type === "youtube") {
      const id = url.searchParams.get("v") ?? "";
      return {
        "@type": "ListItem",
        position: index + 1,
        item: {
          "@type": "VideoObject",
          name: item.title,
          description: item.description,
          embedUrl: `https://www.youtube.com/embed/${id}`,
          url: item.url
        }
      };
    }
    const spotifyId = url.pathname.split("/").pop() ?? "";
    return {
      "@type": "ListItem",
      position: index + 1,
      item: {
        "@type": "AudioObject",
        name: item.title,
        description: item.description,
        embedUrl: `https://open.spotify.com/embed/episode/${spotifyId}`,
        url: item.url
      }
    };
  })
};
---
<BaseLayout title={title} description={description}>
  <div class="page">
    <Nav />
    <main class="content">
      <header class="content-header">
        <p class="eyebrow">Media</p>
        <h1>Interviews and conversations.</h1>
        <p class="lead">A place for talks, interviews, and appearances.</p>
      </header>

      <section class="content-block">
        {mediaItems.length === 0 ? (
          <div class="empty-state">
            <p>Add your YouTube or podcast interviews here.</p>
          </div>
        ) : (
          <div class="media-grid">
            {mediaItems.map((item) => {
              const url = new URL(item.url);
              const id = item.type === "youtube" ? url.searchParams.get("v") ?? "" : "";
              const spotifyId = item.type === "spotify" ? url.pathname.split("/").pop() ?? "" : "";
              return (
                <div class="media-card">
                  <div class="media-embed">
                    <iframe
                      loading="lazy"
                      src={
                        item.type === "youtube"
                          ? `https://www.youtube.com/embed/${id}`
                          : `https://open.spotify.com/embed/episode/${spotifyId}`
                      }
                      title={item.title}
                      frameborder="0"
                      allow="accelerometer; autoplay; clipboard-write; encrypted-media; gyroscope; picture-in-picture"
                      allowfullscreen
                    />
                  </div>
                  <div class="media-meta">
                    <h2>{item.title}</h2>
                    <p>{item.description}</p>
                    <a class="text-link" href={item.url} rel="noopener noreferrer" target="_blank">Watch on YouTube</a>
                    <div class="media-transcript">
                      <h3>Transcript</h3>
                      {item.transcript.length ? (
                        item.transcript.map((line) => <p>{line}</p>)
                      ) : (
                        <p>Transcript available upon request.</p>
                      )}
                    </div>
                  </div>
                </div>
              );
            })}
          </div>
        )}
      </section>
    </main>
    <Footer />
  </div>
  <script type="application/ld+json">{JSON.stringify(itemListSchema)}</script>
</BaseLayout>
